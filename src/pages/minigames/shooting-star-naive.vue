<template>
    <!-- æ©Ÿèƒ½ -->
    <button-20250822 ref="button1Ref"/>

    <!-- ä»¥é™ã€ãƒšãƒ¼ã‚¸ -->
    <the-app-header/>

    <button-to-back-to-contents
        class="sec-0 mt-6"
        pagePath="."
    />

    <h1>ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ã‚¹ã‚¿ãƒ¼</h1>
    <section class="sec-1 pt-6 mb-6">

        <!-- ã‚²ãƒ¼ãƒ ã®æ“ä½œæ–¹æ³• -->
        <v-btn @click="gameMachine1ManualIsShowing = !gameMachine1ManualIsShowing">{{ gameMachine1ManualIsShowing ? 'ã‚²ãƒ¼ãƒ ã®éŠã³æ–¹ã‚’é–‰ã˜ã‚‹' : 'ã‚²ãƒ¼ãƒ ã®éŠã³æ–¹ã‚’è¡¨ç¤º' }}</v-btn>
        <section class="sec-1 pt-6 pb-6" v-if="gameMachine1ManualIsShowing">
            <p>
                ã“ã®ã‚²ãƒ¼ãƒ ã¯ã€æ˜Ÿã‚’æ’®å½±ã™ã‚‹ã€ã¨ã„ã†çŠ¶æ³ã‚’è¦‹ç«‹ã¦ãŸã‚²ãƒ¼ãƒ ã ãœã€‚<br/>
                <br/>
                ä¸‹ã«é»’ã„ç”»é¢ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’åºƒã’ã¦ãã‚Œã ãœã€‚<br/>
                ã“ã®é»’ã„ç”»é¢ã¯å®‡å®™ãªã€‚<br/>
                ï¼»â–¶ï¼½ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚‹ãœã€‚<br/>
                ãŸã¾ã«æ˜ŸãŒæµã‚Œã¦ãã‚‹ã€‚<br/>
                60ç§’ã®é–“ã«ã€ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆç‚¹ç·šã®é•·æ–¹å½¢ã ï¼‰ã‚’ä¸Šä¸‹å·¦å³ã«å‹•ã‹ã—ã¦ã€æ˜Ÿã‚’ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã®ä¸­ã«å…¥ã£ã¦ã„ã‚‹ã¨ãã«ã€ï¼»ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ï¼‰ï¼½ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã‚Œã ãœã€‚ã“ã‚Œã§ 100ç‚¹ ã ãœã€‚<br/>
                <br/>
                é£½ããŸã‚‰çµ‚ã‚ã‚Šã ãœã€‚<br/>
                <br/>
                ã˜ã‚ƒã‚ã€ï¼»ã‚²ãƒ¼ãƒ ã®éŠã³æ–¹ã‚’é–‰ã˜ã‚‹ï¼½ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã‚Œã ãœã€‚
            </p>
        </section>

        <p class="mt-6">ãƒœã‚¿ãƒ³</p>
        <section class="sec-0 mb-6">
            <!-- ãƒœã‚¿ãƒ³ã‚’ä¸¦ã¹ã‚‹ -->

            
            <v-btn
                class="code-key"
                @touchstart.prevent="button1Ref?.press($event, onPowerOnButtonPushed, {repeat: false});"
                @touchend="button1Ref?.release();"
                @touchcancel="button1Ref?.release();"
                @touchleave="button1Ref?.release();"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, onPowerOnButtonPushed, {repeat: false})"
                @mouseup="button1Ref?.release();"
                @mouseleave="button1Ref?.release();"
            >{{ gameMachine1IsPowerOn ? "Off" : "On" }}</v-btn>

            
            <v-btn
                class="code-key"
                :disabled="!startButton1Enabled"
                @touchstart.prevent="button1Ref?.press($event, onGameStartOrEndButtonPushed, {repeat: false});"
                @touchend="button1Ref?.release();"
                @touchcancel="button1Ref?.release();"
                @touchleave="button1Ref?.release();"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, onGameStartOrEndButtonPushed, {repeat: false})"
                @mouseup="button1Ref?.release();"
                @mouseleave="button1Ref?.release();"
            >{{ gameMachine1IsPlaying ? "â¹" : "â–¶" }}</v-btn>


            <v-btn
                class="code-key"
                :disabled="!pauseButton1Enabled"
                @touchstart.prevent="button1Ref?.press($event, onGamePauseOrRestartButtonPushed, {repeat: false});"
                @touchend="button1Ref?.release();"
                @touchcancel="button1Ref?.release();"
                @touchleave="button1Ref?.release();"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, onGamePauseOrRestartButtonPushed, {repeat: false})"
                @mouseup="button1Ref?.release();"
                @mouseleave="button1Ref?.release();"
            >{{ gameMachine1IsPause ? "â¯" : "â¸" }}</v-btn>


        </section>
        <p style="font-size: x-large; margin-top: 8px; margin-bottom: 8px;">
            ã‚¹ã‚³ã‚¢ï¼š {{ gameMachine1Score }}ã€€ã€€æ®‹ã‚Šæ™‚é–“: {{ Math.floor((gameMachine1MaxCount - stopwatch1Count) / commonSeconds) }} . {{ (gameMachine1MaxCount - stopwatch1Count) % commonSeconds }}
        </p>

        <!-- ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã€‚ãƒ‡ãƒãƒƒã‚°ã«ä½¿ã„ãŸã„ã¨ãã¯ã€ display: none; ã‚’æ¶ˆã—ã¦ãã ã•ã„ã€‚ -->
        <stopwatch
            ref="stopwatch1Ref"
            v-on:countUp="(countNum: number) => { stopwatch1Count = countNum; }"
            style="display: none;" />

        
        <!-- ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ï¼‘ -->
        <game-machine-waratch2
            :hardLocationStyle="{
                left: '0px',
                top: '0px',
            }"
            :screenWidth="gameMachine1Zoom * board1FileNum * tileBoard1TileWidth"
            :screenHeight="gameMachine1Zoom * board1RankNum * tileBoard1TileHeight"
            :powerOn="gameMachine1IsPowerOn"
            v-on:onLeftButtonPressed="onLeftButtonPressed"
            v-on:onLeftButtonReleased="onLeftButtonReleased"
            v-on:onUpButtonPressed="onUpButtonPressed"
            v-on:onUpButtonReleased="onUpButtonReleased"
            v-on:onRightButtonPressed="onRightButtonPressed"
            v-on:onRightButtonReleased="onRightButtonReleased"
            v-on:onDownButtonPressed="onDownButtonPressed"
            v-on:onDownButtonReleased="onDownButtonReleased"
            v-on:onSpaceButtonPressed="onSpaceButtonPressed"
            v-on:onSpaceButtonReleased="onSpaceButtonReleased"
        >
            <template #default>
                <!-- ã‚²ãƒ¼ãƒ ç”»é¢ã®å…¨ä½“ã‚µã‚¤ã‚ºã¨ã€åˆ‡ã‚ŠæŠœãé ˜åŸŸ -->
                <div
                    :style="{
                        visibility: gameMachine1Visibility,
                        width: `${board1FileNum * tileBoard1TileWidth}px`,
                        height: `${board1RankNum * tileBoard1TileHeight}px`,
                        zoom: gameMachine1Zoom,
                    }"
                    style="
                        position:relative;
                        left: 0;
                        top: 0;
                        background-color: #303030;
                    "
                >
                    <!--
                        ã‚°ãƒªãƒƒãƒ‰
                        NOTE: ãƒ«ãƒ¼ãƒ—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯ 1 ã‹ã‚‰å§‹ã¾ã‚‹ã®ã§ã€1ï½9ã®9å€‹ã®ã‚»ãƒ«ã‚’ä½œæˆã€‚
                    -->
                    <div
                        v-for="i in board1Area"
                        :key="i"
                        :style="{
                            top: `${Math.floor((i - 1) / board1FileNum) * tileBoard1TileHeight}px`,
                            left: `${((i - 1) % board1FileNum) * tileBoard1TileWidth}px`,
                            width: `${tileBoard1TileWidth}px`,
                            height: `${tileBoard1TileHeight}px`,
                        }"
                        style="
                            position: absolute;
                            border: solid 1px gray;
                        "
                        ></div>

                    <!-- æ˜Ÿ -->
                    <Tile
                        :srcLeft="0"
                        :srcTop="0"
                        :srcWidth="tileBoard1TileWidth"
                        :srcHeight="tileBoard1TileHeight"
                        tilemapUrl="/img/making/sprite-objects-001.png"
                        :style="starStyle"
                        style="position:absolute;" /><br/>

                    <!-- ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆç‚¹ç·šã®æ ï¼‰ -->
                    <div
                        class="player"
                        :style="playerStyle"
                        style="position:absolute;" ></div>

                    <!-- ãƒªãƒ­ãƒ¼ãƒ‰ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆãƒ‘ã‚¤ã¿ãŸã„ãªã‚„ã¤ï¼‰ -->
                    <Tile
                        :srcLeft="reloadPie1TileLeft"
                        :srcTop="reloadPie1TileTop"
                        :srcWidth="tileBoard1TileWidth"
                        :srcHeight="tileBoard1TileHeight"
                        tilemapUrl="/img/making/202508__warabenture__16-2357-8counts-red.png"
                        :style="reloadPieStyle"
                        style="position:absolute;" /><br/>
                        
                    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <p
                        v-if="!gameMachine1IsPlaying"
                        :style="{
                            left: `${tileBoard1TileWidth}px`,
                            top: `${8 * tileBoard1TileHeight}px`,
                            width: `${14 * tileBoard1TileHeight}px`,
                        }"
                        style="
                            position: absolute;
                            font-size: 28px;
                            color: white;
                        "
                    >ãƒœã‚¿ãƒ³æ“ä½œã®ç·´ç¿’ãŒã§ãã¾ã™ã€‚ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ã‚²ãƒ¼ãƒ æ©Ÿã®ä¸Šã®ï¼»â–¶ï¼½ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
                </div>

            </template>
        </game-machine-waratch2>


        <section class="sec-0 mt-6 mb-6">
            <!-- ãŠå¥½ã¿è¨­å®šãƒ‘ãƒãƒ«ï¼‘ -->
            <v-btn
                class="code-key"
                @touchstart.prevent="button1Ref?.press($event, onPreferences1ButtonPressed);"
                @touchend="button1Ref?.release();"
                @touchcancel="button1Ref?.release();"
                @touchleave="button1Ref?.release();"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, onPreferences1ButtonPressed)"
                @mouseup="button1Ref?.release();"
                @mouseleave="button1Ref?.release();"
            >{{ gameMachine1PreferencesIsShowing ? 'âš™ï¸ãŠå¥½ã¿è¨­å®šã‚’çµ‚ã‚ã‚‹' : 'âš™ï¸ãŠå¥½ã¿è¨­å®šã‚’è¡¨ç¤º' }}</v-btn>
            <section
                v-if="gameMachine1PreferencesIsShowing"
                class="sec-0 pt-6 pb-6"
                style="background-color: rgb(0, 0, 0, 0.1);"
            >
                <v-slider
                    label="ã‚ºãƒ¼ãƒ "
                    v-model="gameMachine1Zoom"
                    :min="0.375"
                    :max="4"
                    step="0.125"
                    showTicks="always"
                    thumbLabel="always" />
            </section>
        </section>

        
        <!-- ãƒ‡ãƒãƒƒã‚°ç”¨ -->
        <!--
            <p>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ã‚¹ãƒ†ãƒƒãƒ—: {{ appGameScheduleStep.value }}</p>
            <p>æ˜Ÿã€€è¡Œï¼š {{ star1Ranks }}</p>
            <p>æ˜Ÿã€€åˆ—ï¼š {{ star1Files }}</p>
            <p>ãƒªãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¿ã‚¤ãƒ : {{ player1ReloadTime.value }}</p>
            <br/>
            <p>å…ƒç”»åƒã®ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—ã‚’è¡¨ç¤ºï¼š</p>
            <v-img src="/img/making/sprite-objects-001.png" style="width:128px; height:128px; border: dashed 4px gray;"/><br/>
            <v-img src="/img/making/202508__warabenture__16-2357-8counts-red.png" style="width:128px; height:64px; border: dashed 4px gray;"/><br/>
            ï¼šã“ã“ã¾ã§ã€‚
        -->
    </section>
    
    <button-to-go-to-top class="sec-1 pt-6"/>
    <h2>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰</h2>
    <section class="sec-2">
        <source-link/>
    </section>

    <button-to-go-to-top class="sec-0 pt-6"/>
</template>

<script setup lang="ts">

    console.log("ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚¿ãƒ¼ã€€ï¼ˆåˆç´šè€…å‘ã‘ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç‰ˆï¼‰")

    // ##############
    // # ã‚¤ãƒ³ãƒãƒ¼ãƒˆ #
    // ##############

    import { computed, onMounted, onUnmounted, ref, watch } from 'vue';
    // ğŸ‘† ï¼»åˆç´šè€…å‘ã‘ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼½ã§ã¯ã€ reactive ã¯ä½¿ã„ã¾ã›ã‚“ã€‚

    import { VBtn } from 'vuetify/components';

    // ++++++++++++++++++++++++++++++++++
    // + ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€€ï¼ã€€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ +
    // ++++++++++++++++++++++++++++++++++

    // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †
    import Button20250822 from '@/components/Button20250822.vue';
    import ButtonToBackToContents from '@/components/ButtonToBackToContents.vue';
    import ButtonToGoToTop from '@/components/ButtonToGoToTop.vue';
    import GameMachineWaratch2 from '@/components/GameMachineWaratch2.vue';
    import SourceLink from '@/components/SourceLink.vue';
    import Stopwatch from '@/components/Stopwatch.vue';
    import Tile from '@/components/Tile.vue';

    // ++++++++++++++++++++++++++
    // + ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€€ï¼ã€€ãƒšãƒ¼ã‚¸ +
    // ++++++++++++++++++++++++++

    import TheAppHeader from '../the-app-header.vue';


    // ##########
    // # ã‚³ãƒ¢ãƒ³ #
    // ##########
    //
    // ã‚ˆãä½¿ã†è¨­å®šã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã€‚ç‰¹ã«ä¸å¤‰ã®ã‚‚ã®ã€‚
    //

    const commonSeconds = 60; // 1ç§’ã¯60ãƒ•ãƒ¬ãƒ¼ãƒ 
    const commonSpriteMotionLeft = -1;  // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆmotionï¼‰å®šæ•°ã€‚ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ãŒå·¦ã«ç§»å‹•ã™ã‚‹
    const commonSpriteMotionRight = 1;
    const commonSpriteMotionUp = -1;
    const commonSpriteMotionDown = 1;


    // ################
    // # èª­è¾¼ãƒªã‚½ãƒ¼ã‚¹ #
    // ################

    // ++++++++++++++++++++++++++++
    // + èª­è¾¼ãƒªã‚½ãƒ¼ã‚¹ã€€ï¼ã€€åŠ¹æœéŸ³ +
    // ++++++++++++++++++++++++++++

    const sfxConfigVolume = 0.3;                        // éŸ³é‡

    let sfxDeniedAudio: HTMLAudioElement;               // æ‹’å¦éŸ³
    let sfxDeniedIsPlaying: boolean = false;            // æ‹’å¦éŸ³ã®å†ç”ŸçŠ¶æ…‹
    let sfxCameraShutterAudio: HTMLAudioElement;        // ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã—ãŸã¨ãã®åŠ¹æœéŸ³
    let sfxCameraShutterIsPlaying: boolean = false;     //
    let sfxMissAudio: HTMLAudioElement;                 // ãƒŸã‚¹éŸ³
    let sfxMissIsPlaying: boolean = false;              //

    /**
     * åŠ¹æœéŸ³ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ˆjsfxrã§ä½œã£ãŸåŠ¹æœéŸ³ï¼‰
     */
    function sfxLoad() : void {
        sfxDeniedAudio = new Audio('/wav/202508__sfx__17-0200-denied.wav'); // æ‹’å¦éŸ³
        sfxDeniedAudio.volume = sfxConfigVolume;
        sfxDeniedAudio.addEventListener('play', () => { sfxDeniedIsPlaying = true })
        sfxDeniedAudio.addEventListener('pause', () => { sfxDeniedIsPlaying = false })
        sfxDeniedAudio.addEventListener('ended', () => { sfxDeniedIsPlaying = false })

        sfxCameraShutterAudio = new Audio('/wav/202508__sfx__16-2117-cameraShutter.wav'); // ã‚«ãƒ¡ãƒ©ã®ã‚·ãƒ£ãƒƒã‚¿ãƒ¼éŸ³
        sfxCameraShutterAudio.volume = sfxConfigVolume;
        sfxCameraShutterAudio.addEventListener('play', () => { sfxCameraShutterIsPlaying = true })
        sfxCameraShutterAudio.addEventListener('pause', () => { sfxCameraShutterIsPlaying = false })
        sfxCameraShutterAudio.addEventListener('ended', () => { sfxCameraShutterIsPlaying = false })

        sfxMissAudio = new Audio('/wav/202508__sfx__16-2146-miss.wav'); // ãƒŸã‚¹éŸ³
        sfxMissAudio.volume = sfxConfigVolume;
        sfxMissAudio.addEventListener('play', () => { sfxMissIsPlaying = true })
        sfxMissAudio.addEventListener('pause', () => { sfxMissIsPlaying = false })
        sfxMissAudio.addEventListener('ended', () => { sfxMissIsPlaying = false })
    }


    // ################
    // # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #
    // ################

    // ++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€æ‹¡å¼µæ©Ÿèƒ½ +
    // ++++++++++++++++++++++++++++++

    const button1Ref = ref<InstanceType<typeof Button20250822> | null>(null);

    // ++++++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ï¼‘ +
    // ++++++++++++++++++++++++++++++++++++

    const gameMachine1ManualIsShowing = ref<boolean>(false);    // ã‚²ãƒ¼ãƒ ã®æ“ä½œæ–¹æ³•ãƒ»éŠã³æ–¹èª¬æ˜æ›¸ã‚’è¡¨ç¤ºä¸­
    const gameMachine1IsPowerOn = ref<boolean>(false);  // é›»æºãƒœã‚¿ãƒ³ã¯æ¼”å‡ºã§ã™
    const gameMachine1Visibility = ref<string>('hidden');
    const gameMachine1IsPlaying = ref<boolean>(false);  // ã‚²ãƒ¼ãƒ ä¸­
    const gameMachine1IsPause = ref<boolean>(false);    // ã‚²ãƒ¼ãƒ ã¯ä¸€æ™‚åœæ­¢ä¸­
    const gameMachine1Zoom = ref<number>(0.375);    // ã‚ºãƒ¼ãƒ 
    const gameMachine1Score = ref<number>(0);   // å¾—ç‚¹
    const gameMachine1MaxCount = computed(()=>60 * commonSeconds);  // ã‚²ãƒ¼ãƒ æ™‚é–“ã¯ï¼‘åˆ†
    const gameMachine1ScheduleStep = ref<number>(0);    // æ˜Ÿã®å‡ºç¾ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ï¼‘ã€€ï¼ã€€é–‹å§‹ï¼çµ‚äº†ãƒœã‚¿ãƒ³ +
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

    const startButton1Enabled = ref<boolean>(false);

    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ï¼‘ã€€ï¼ã€€ä¸€æ™‚åœæ­¢ï¼å†é–‹ãƒœã‚¿ãƒ³ +
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

    const pauseButton1Enabled = ref<boolean>(false);

    // ++++++++++++++++++++++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ï¼‘ã€€ï¼ã€€ãŠå¥½ã¿è¨­å®š +
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++

    const gameMachine1PreferencesIsShowing = ref<boolean>(false);

    // ++++++++++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒï¼‘ +
    // ++++++++++++++++++++++++++++++++++++++++

    const stopwatch1Ref = ref<InstanceType<typeof Stopwatch> | null>(null); // Stopwatch ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    const stopwatch1Count = ref<number>(0);   // ã‚«ã‚¦ãƒ³ãƒˆã®åˆæœŸå€¤
    watch(stopwatch1Count, (newCount) => {
        // ã‚«ã‚¦ãƒ³ãƒˆãŒå¤‰ã‚ã£ãŸã‚‰ã€ä½•ã‹å‡¦ç†ã‚’ã—ãŸã„ã€‚

        // ----------------------------------------------------------
        // - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒï¼‘ã€€ï¼ã€€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« -
        // ----------------------------------------------------------

        switch (gameMachine1ScheduleStep.value) {
            case 0:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰1ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 1 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 5;
                    star1StartRanks.value = 3;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;                    
                }
                break;
            case 1:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰3ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 3 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 2:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰4ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 4 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 9;
                    star1StartRanks.value = 9;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 3:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰6ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 6 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 4:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰8ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 8 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 0;
                    star1StartRanks.value = 8;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 5:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰10ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 10 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 6:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰14ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 14 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 12;
                    star1StartRanks.value = 5;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 7:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰15ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 15 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 8:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰19ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 19 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 3;
                    star1StartRanks.value = 3;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 9:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰21ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 21 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 10:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰27ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 27 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 6;
                    star1StartRanks.value = 11;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 11:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰29ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 29 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 12:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰33ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 33 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 4;
                    star1StartRanks.value = 6;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 13:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰36ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 36 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 14:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰39ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 39 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 5;
                    star1StartRanks.value = 0;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 15:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰41ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 41 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 16:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰45ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 45 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 6;
                    star1StartRanks.value = 7;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 17:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰48ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 48 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 18:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰51ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 51 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 7;
                    star1StartRanks.value = 3;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 19:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰54ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 54 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 20:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰57ç§’å¾Œã€æ˜Ÿè¡¨ç¤º
                if (newCount >= 57 * commonSeconds) {
                    star1StartTime.value = newCount;
                    star1StartFiles.value = 8;
                    star1StartRanks.value = 9;
                    star1Visibility.value = 'visible';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
            case 21:
                // ã‚²ãƒ¼ãƒ é–‹å§‹ã‹ã‚‰60ç§’å¾Œã€æ˜Ÿéè¡¨ç¤º
                if (newCount >= 59 * commonSeconds) {
                    star1Visibility.value = 'hidden';
                    gameMachine1ScheduleStep.value += 1;
                }
                break;
        }

        if (newCount >= gameMachine1MaxCount.value) {
            // ã‚²ãƒ¼ãƒ åœæ­¢
            stopwatch1Ref.value?.timerStop();  // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ãƒˆãƒƒãƒ—
        }
    });

    // ++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ã‚¿ã‚¤ãƒ«ç›¤ï¼‘ +
    // ++++++++++++++++++++++++++++++++

    // NOTE: ã‚½ãƒ¼ã‚¹ç”»åƒãƒãƒƒãƒ—ã¨ã€è¡¨ç¤ºç”»é¢ã®ã‚¹ã‚±ãƒ¼ãƒ«ã¯ç­‰å€ã¨ã—ã¾ã™ã€‚å¤‰ãˆã‚‹ã¨é›£ã—ã„ã€‚
    const tileBoard1TileWidth = ref<number>(32);  // ãƒã‚¹ã®æ¨ªå¹…ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰
    const tileBoard1TileHeight = ref<number>(32); // ãƒã‚¹ã®ç¸¦å¹…ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰
    const board1FileNum = ref<number>(16);        // ç›¤ãŒæ¨ªã«ä½•ãƒã‚¹ã‹
    const board1RankNum = ref<number>(12);        // ç›¤ãŒç¸¦ã«ä½•ãƒã‚¹ã‹
    const board1Area = computed(()=>{           // ç›¤ã®ãƒã‚¹æ•°
        return board1FileNum.value * board1RankNum.value;
    });

    // ++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€æ˜Ÿ +
    // ++++++++++++++++++++++++

    const star1StartFiles = ref<number>(0);      // ç›¤ãŒæ¨ªã«ä½•ã‚»ãƒ«ã‹
    const star1StartRanks = ref<number>(0);      // æ˜Ÿã®å‡ºç¾ä½ç½®ã€‚ç›¤ã®ä¸Šã‹ã‚‰ä½•ã‚»ãƒ«ã‹
    const star1StartTime = ref<number>(0);      // æ˜Ÿã®å‡ºç¾countæ™‚é–“
    const star1Visibility = ref<'hidden' | 'visible'>('hidden');    // æ˜Ÿã®è¡¨ç¤ºï¼éè¡¨ç¤º

    const star1Files = computed(()=>{
        return star1StartFiles.value + Math.floor((stopwatch1Count.value - star1StartTime.value) / 20);
    });
    const star1Ranks = computed(()=>{
        return star1StartRanks.value;
    });
    const starStyle = computed(() => {
        return {
            visibility: star1Visibility.value,
            top: `${star1Ranks.value * tileBoard1TileHeight.value}px`,
            left: `${star1Files.value * tileBoard1TileWidth.value}px`,
            width: `${tileBoard1TileWidth.value}px`,
            height: `${tileBoard1TileHeight.value}px`,
        };
    });

    // ++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€è‡ªæ©Ÿï¼‘ +
    // ++++++++++++++++++++++++++++
    //
    // ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã€‚ç‚¹ç·šã®æ ã€‚
    //

    const player1Left = ref<number>(6 * tileBoard1TileWidth.value);     // ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®Xåº§æ¨™
    const player1Top = ref<number>(4 * tileBoard1TileHeight.value);     // ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®Yåº§æ¨™
    const player1FileNum = ref<number>(4);                            // ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®åˆ—æ•°
    const player1RankNum = ref<number>(3);                            // ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®è¡Œæ•°
    const player1Input = <Record<string, boolean>>{                     // å…¥åŠ›
        // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †
        " ": false, ArrowDown: false, ArrowLeft: false, ArrowUp: false, ArrowRight: false,
    };
    const player1MotionWait = ref<number>(0);   // æ’ä»–çš„ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã€‚
    const player1AnimationWalkingFrames = 8;                        // æ­©è¡Œãƒ•ãƒ¬ãƒ¼ãƒ æ•°
    const player1SpeedHorizontal = ref<number>(tileBoard1TileWidth.value / player1AnimationWalkingFrames);  // ç§»å‹•é€Ÿåº¦ã€‚å‰²ã‚Šåˆ‡ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨
    const player1SpeedVertical = ref<number>(tileBoard1TileHeight.value / player1AnimationWalkingFrames);
    const player1Motion = ref<Record<string, number>>({             // å…¥åŠ›
        xAxis: 0,   // è² ãªã‚‰å·¦ã€æ­£ãªã‚‰å³
        yAxis: 0,   // è² ãªã‚‰ä¸Šã€æ­£ãªã‚‰ä¸‹
    });
    const player1ReloadTime = ref<number>(0);                       // 0 ã«ãªã‚‹ã¾ã§ã€å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„
    const playerStyle = computed(() => {
        return {
            top: `${player1Top.value}px`,
            left: `${player1Left.value}px`,
            width: `${player1FileNum.value * tileBoard1TileWidth.value}px`,
            height: `${player1RankNum.value * tileBoard1TileHeight.value}px`,
            border: `dashed 4px ${player1ReloadTime.value > 0 ? '#d85050' : '#f0f0f0'}`, // ãƒªãƒ­ãƒ¼ãƒ‰ä¸­ã¯èµ¤ã„æ 
        };
    });

    // ++++++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ãƒªãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ‘ã‚¤ +
    // ++++++++++++++++++++++++++++++++++++
    //
    // å†™çœŸã‚’æ’®ã£ãŸæ™‚ã«ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã®ä¸­å¿ƒã§å›ã£ã¦ã‚‹ã‚„ã¤ã€‚
    //

    const reloadPie1Frames = <
        Record<number, {top: number, left: number}>
    >{
        0: {top: 0 * tileBoard1TileHeight.value, left: 0 * tileBoard1TileWidth.value},
        1: {top: 0 * tileBoard1TileHeight.value, left: 1 * tileBoard1TileWidth.value},
        2: {top: 0 * tileBoard1TileHeight.value, left: 2 * tileBoard1TileWidth.value},
        3: {top: 0 * tileBoard1TileHeight.value, left: 3 * tileBoard1TileWidth.value},
        4: {top: 1 * tileBoard1TileHeight.value, left: 0 * tileBoard1TileWidth.value},
        5: {top: 1 * tileBoard1TileHeight.value, left: 1 * tileBoard1TileWidth.value},
        6: {top: 1 * tileBoard1TileHeight.value, left: 2 * tileBoard1TileWidth.value},
        7: {top: 1 * tileBoard1TileHeight.value, left: 3 * tileBoard1TileWidth.value},
    };
    const reloadPie1Weight = 3 * commonSeconds;
    const reloadPie1Index = computed<number>(()=>{
        // ã‚¿ã‚¤ãƒ«ï¼‘æšå½“ãŸã‚Šã®æ™‚é–“ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰
        const frameNum = Object.keys(reloadPie1Frames).length;
        const unitTime = reloadPie1Weight / frameNum;
        let index = Math.floor(player1ReloadTime.value / unitTime);
        if (index >= frameNum) {
            index = frameNum - 1;
        }
        return (frameNum - 1) - index;    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
    });
    const reloadPie1TileLeft = computed<number>(()=>{
        return reloadPie1Frames[reloadPie1Index.value].left;
    });
    const reloadPie1TileTop = computed<number>(()=>{
        return reloadPie1Frames[reloadPie1Index.value].top;
    });
    const reloadPieStyle = computed(() => {
        return {
            visibility: player1ReloadTime.value > 0 ? 'visible' : 'hidden',
            top: `${player1Top.value + player1RankNum.value * tileBoard1TileHeight.value / 2 - tileBoard1TileHeight.value / 2}px`,
            left: `${player1Left.value + player1FileNum.value * tileBoard1TileWidth.value / 2 - tileBoard1TileWidth.value / 2}px`,
        };
    });


    // ###############
    // # é–‹å§‹ / çµ‚äº† #
    // ###############

    onMounted(() => {
        sfxLoad();
        powerOn();  // é›»æºã‚’å…¥ã‚Œã‚‹æ¼”å‡º
        gameInit();
        gameLoopStart();

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®è¨­å®š
        //
        //      window ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ã€ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§ã¯ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ããªã„ã®ã§ï¼‰ãƒã‚¦ãƒ³ãƒˆå¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
        //
        window.addEventListener('keydown', (e: KeyboardEvent) => {
            // ã‚¹ãƒšãƒ¼ã‚¹ã€ä¸Šä¸‹ã‚­ãƒ¼ã®å ´åˆ
            if (e.key == ' ' || e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                // ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä¸Šä¸‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‹•ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                e.preventDefault();
            }

            if (player1Input.hasOwnProperty(e.key)) {
                player1Input[e.key] = true;
            }
        });
        window.addEventListener('keyup', (e) => {
            if (player1Input.hasOwnProperty(e.key)) {
                player1Input[e.key] = false;
            }
        });
    });


    onUnmounted(()=>{
        // åŠ¹æœéŸ³ã®ãƒ¡ãƒ¢ãƒªè§£æ”¾ã‚’çœŸé¢ç›®ã«è¡Œã†å ´åˆ
        if (sfxDeniedAudio) {
            sfxDeniedAudio.pause();
            sfxDeniedAudio.src = '';
            sfxDeniedAudio.load(); // ãƒãƒƒãƒ•ã‚¡ã‚¯ãƒªã‚¢
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è§£é™¤ï¼ˆå¿…è¦ãªã‚‰ï¼‰
            // sfxDeniedAudio.removeEventListener('ended', handler);
        }

        if (sfxCameraShutterAudio) {
            sfxCameraShutterAudio.pause();
            sfxCameraShutterAudio.src = '';
            sfxCameraShutterAudio.load(); // ãƒãƒƒãƒ•ã‚¡ã‚¯ãƒªã‚¢
        }

        if (sfxMissAudio) {
            sfxMissAudio.pause();
            sfxMissAudio.src = '';
            sfxMissAudio.load(); // ãƒãƒƒãƒ•ã‚¡ã‚¯ãƒªã‚¢
        }
    });


    // ################
    // # ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ #
    // ################

    /**
     * é›»æºãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
     */
    function onPowerOnButtonPushed() : void {
        if(gameMachine1IsPowerOn.value) {
            powerOff();
            return;
        }

        powerOn();
    }


    /**
     * ï¼»â–¶ï¼½ï¼ˆå†ç”Ÿï¼‰ã¾ãŸã¯ï¼»â¹ï¼½ï¼ˆåœæ­¢ï¼‰ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã€‚ï¼ˆçŠ¶æ…‹ã«ã‚ˆã‚Šåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ï¼‰
     */
    function onGameStartOrEndButtonPushed() : void {
        if(gameMachine1IsPlaying.value) {
            gameStop();
            return;
        }

        gameStart();
    }


    function powerOn() : void {
        startButton1Enabled.value = true;
        gameMachine1Visibility.value = 'visible';
        gameMachine1IsPowerOn.value = true;
    }


    function powerOff() : void {
        if(gameMachine1IsPlaying.value) {    // ã‚²ãƒ¼ãƒ ä¸­ãªã‚‰ã€åœæ­¢ã•ã›ã¾ã™
            gameStop();
        }

        startButton1Enabled.value = false;
        gameMachine1Visibility.value = 'hidden';
        gameMachine1IsPowerOn.value = false;
    }


    function gameStart() : void {
        stopwatch1Ref.value?.timerStart();  // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆ
        pauseButton1Enabled.value = true;
        gameMachine1IsPlaying.value = !gameMachine1IsPlaying.value;
    }


    function gameStop() : void {
        pauseButton1Enabled.value = false;
        gameInit(); // ã‚²ãƒ¼ãƒ ã¯çµ‚äº†ã—ãŸã®ã§ã€åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™
    }


    /**
     * ï¼»â¸ï¼½ï¼ˆä¸€æ™‚åœæ­¢ï¼‰ã¾ãŸã¯ï¼»â¯ï¼½ï¼ˆå†é–‹ï¼‰ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã€‚ï¼ˆçŠ¶æ…‹ã«ã‚ˆã‚Šåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ï¼‰
     */
    function onGamePauseOrRestartButtonPushed() : void {
        if(gameMachine1IsPause.value) {
            // FIXME: ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã«ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒè² ã«é€²ã‚“ã§ã—ã¾ã†ã€‚
            stopwatch1Ref.value?.timerStart();  // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆ
        } else {
            stopwatch1Ref.value?.timerStop();  // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ãƒˆãƒƒãƒ—
        }

        gameMachine1IsPause.value = !gameMachine1IsPause.value;
    }


    /**
     * ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–
     */
    function gameInit() : void {
        stopwatch1Ref.value?.timerReset();  // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ

        gameMachine1Score.value = 0;
        gameMachine1IsPlaying.value = false;
        gameMachine1IsPause.value = false;
        gameMachine1ScheduleStep.value = 0;

        star1Visibility.value = 'hidden';
    }


    /**
     * ã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—é–‹å§‹
     */
    function gameLoopStart() : void {
        const update = () => {
            // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¿ã‚¤ãƒãƒ¼
            player1MotionWait.value -= 1;

            if (player1ReloadTime.value > 0) {
                // ãƒªãƒ­ãƒ¼ãƒ‰ä¸­
                player1ReloadTime.value -= 1;
            }

            if (player1MotionWait.value==0) {
                player1Motion.value["xAxis"] = 0;    // ã‚¯ãƒªã‚¢ãƒ¼
                player1Motion.value["yAxis"] = 0;
            }
            
            // ++++++++++++++++++++++++++++++
            // + ã‚­ãƒ¼å…¥åŠ›ã‚’ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤‰æ› +
            // ++++++++++++++++++++++++++++++
            if (player1MotionWait.value<=0) {   // ã‚¦ã‚§ã‚¤ãƒˆãŒç„¡ã‘ã‚Œã°ã€å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ã€‚

                if (player1Input[" "]) {
                    cameraShot();   // æ’®å½±
                }

                if (player1Input.ArrowLeft) {
                    player1Motion.value["xAxis"] = commonSpriteMotionLeft; // å·¦
                }

                if (player1Input.ArrowRight) {
                    player1Motion.value["xAxis"] = commonSpriteMotionRight;  // å³
                }

                if (player1Input.ArrowUp) {
                    player1Motion.value["yAxis"] = commonSpriteMotionUp;   // ä¸Š
                }

                if (player1Input.ArrowDown) {
                    player1Motion.value["yAxis"] = commonSpriteMotionDown;   // ä¸‹
                }

                if (player1Motion.value["xAxis"]!=0 || player1Motion.value["yAxis"]!=0) {
                    player1MotionWait.value = player1AnimationWalkingFrames;
                }
            }

            // ç§»å‹•å‡¦ç†
            // æ–œã‚æ–¹å‘ã®å ´åˆã€ä¸Šä¸‹ã‚’å„ªå…ˆã™ã‚‹ã€‚
            if (player1Motion.value["xAxis"]==1) {   // å³
                if (player1Left.value < (board1FileNum.value - player1FileNum.value) * tileBoard1TileWidth.value) {    // å¢ƒç•Œãƒã‚§ãƒƒã‚¯
                    player1Left.value += player1SpeedHorizontal.value;
                }
            } else if (player1Motion.value["xAxis"]==-1) {  // å·¦
                if (0 < player1Left.value) {    // å¢ƒç•Œãƒã‚§ãƒƒã‚¯
                    player1Left.value -= player1SpeedHorizontal.value;
                }
            }

            if (player1Motion.value["yAxis"]==-1) {  // ä¸Š
                if (0 < player1Top.value) {    // å¢ƒç•Œãƒã‚§ãƒƒã‚¯
                    player1Top.value -= player1SpeedVertical.value;
                }
            } else if (player1Motion.value["yAxis"]==1) {   // ä¸‹
                if (player1Top.value < (board1RankNum.value - player1RankNum.value) * tileBoard1TileHeight.value) {    // å¢ƒç•Œãƒã‚§ãƒƒã‚¯
                    player1Top.value += player1SpeedVertical.value;
                }
            }

            // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ 
            requestAnimationFrame(update);
        };

        // åˆå›å‘¼ã³å‡ºã—
        requestAnimationFrame(update);
    }


    /**
     * ã‚«ãƒ¡ãƒ©ã‚·ãƒ§ãƒƒãƒˆå‡¦ç†
     */
    function cameraShot() : void {

        if (player1ReloadTime.value > 0) {
            // ãƒªãƒ­ãƒ¼ãƒ‰ä¸­
            if (!sfxDeniedIsPlaying) {
                // ãƒ–ã‚¶ãƒ¼éŸ³ãŒåœæ­¢ä¸­ãªã‚‰é³´ã‚‰ã™
                sfxDeniedAudio.play();
            }

            // ãƒªãƒ­ãƒ¼ãƒ‰ä¸­ã¯ä½•ã‚‚èµ·ã“ã‚Šã¾ã›ã‚“ã€‚
            return;
        }

        // ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã®ä½ç½®ã¨ã‚µã‚¤ã‚º
        const playerLeftFiles = player1Left.value / tileBoard1TileWidth.value;
        const playerTopRanks = player1Top.value / tileBoard1TileHeight.value;
        const playerRightEndFiles = playerLeftFiles + player1FileNum.value;
        const playerBottomEndRanks = playerTopRanks + player1RankNum.value;

        // ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã®æ å†…ã«æ˜Ÿã‚’å«ã‚€ã‹ï¼Ÿ
        if (
            playerLeftFiles <= star1Files.value && star1Files.value <= playerRightEndFiles &&
            playerTopRanks <= star1Ranks.value && star1Ranks.value <= playerBottomEndRanks) {
            // æ˜Ÿã‚’å«ã‚“ã ã€‚
            niceShot();

        // æ˜Ÿã‚’å«ã¾ãªã„
        } else {
            if (!sfxMissIsPlaying) {
                // ãƒŸã‚¹éŸ³ãŒåœæ­¢ä¸­ãªã‚‰é³´ã‚‰ã™
                sfxMissAudio.play();
            }
        }

        player1ReloadTime.value = reloadPie1Weight;  // ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“ã‚’è¨­å®š
    }


    /**
     * ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã®ä¸­ã«æ˜Ÿã‚’åã‚ã¦æ’®ã£ãŸã¨ãã€‚
     */
    function niceShot() : void {
        if (!sfxCameraShutterIsPlaying) {
            // ã‚«ãƒ¡ãƒ©ã®ã‚·ãƒ£ãƒƒã‚¿ãƒ¼éŸ³ãŒåœæ­¢ä¸­ãªã‚‰é³´ã‚‰ã™
            sfxCameraShutterAudio.play();
        }

        gameMachine1Score.value += 100;
    }


    /**
     * å·¦ã€‚
     */
    function onLeftButtonPressed() : void {
        player1Input.ArrowLeft = true;
    }


    function onLeftButtonReleased() : void {
        player1Input.ArrowLeft = false;
    }


    /**
     * ä¸Šã€‚
     */
    function onUpButtonPressed() : void {
        player1Input.ArrowUp = true;
    }


    function onUpButtonReleased() : void {
        player1Input.ArrowUp = false;
    }


    /**
     * å³ã€‚
     */
    function onRightButtonPressed() : void {
        player1Input.ArrowRight = true;
    }


    function onRightButtonReleased() : void {
        player1Input.ArrowRight = false;
    }


    /**
     * ä¸‹ã€‚
     */
    function onDownButtonPressed() : void {
        player1Input.ArrowDown = true;
    }


    function onDownButtonReleased() : void {
        player1Input.ArrowDown = false;
    }


    /**
     * ã‚¹ãƒšãƒ¼ã‚¹ãƒ»ã‚­ãƒ¼ã€‚
     */
    function onSpaceButtonPressed() : void {
        player1Input[" "] = true;
    }


    function onSpaceButtonReleased() : void {
        player1Input[" "] = false;
    }


    /**
     * ï¼»ãŠå¥½ã¿è¨­å®šãƒ‘ãƒãƒ«ï¼‘ï¼½ã‚’é–‹ããƒœã‚¿ãƒ³ã€‚
     */
    function onPreferences1ButtonPressed() : void {
        gameMachine1PreferencesIsShowing.value = !gameMachine1PreferencesIsShowing.value;
    }

</script>

<style lang="css" scoped>
    @import '@/styles/misc.css';
    @import '@/styles/talk-pen.css';

    /** ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ */
    div.player {
        position: relative; border:dashed 4px #f0f0f0;
    }
</style>
