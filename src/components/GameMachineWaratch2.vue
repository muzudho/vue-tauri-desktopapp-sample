<template>

    <!-- æ©Ÿèƒ½ -->
    <button-20250822 ref="button1Ref"/>


    <!-- ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ï¼šç”»é¢éƒ¨åˆ†é€éç”¨ãƒã‚¹ã‚¯ -->
    <svg width="0" height="0">
        <defs>
            <mask id="waratch2-mask-rect">
                <!-- å…¨ä½“ã®å¤§ãã•ã‚’ç™½ãå¡—ã‚‹ -->
                <rect x="0" y="0" width="320" height="448" fill="white"/>

                <!-- é€éã—ãŸã„ã¨ã“ã‚ã‚’é»’ãå¡—ã‚‹ -->
                <rect x="64" y="64" width="192" height="192" fill="black"/>
            </mask>
        </defs>
    </svg>


    <!-- ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ã®æ ã€ãŠã‚ˆã³ç”»é¢ã«è½ã¡ã‚‹å½±ã€‚
        ãƒã‚¹ã‚¯ã§ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ãƒ£ãƒ‰ã‚¦ã‚’åˆ‡ã‚ŠæŠœã‹ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€ã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ã®å¤–ã«å‡ºã—ã¾ã™ã€‚
        :style="perspectiveMiddle1Style"
    -->
    <div
        :style="props.hardPositionStyle"
        style="
            position: fixed;
            width: calc(5 * 64px);
            height: calc(7 * 64px);
            pointer-events: none;  /* ã‚¯ãƒªãƒƒã‚¯ã‚’é€éã•ã›ã¾ã™ */
        "
    >
        <!--
                left: calc(1 * 64px - 3px); /* ãƒœãƒ¼ãƒ€ãƒ¼å¹…ã‚’å¼•ã„ã¦ã„ã‚‹ */
                top: calc(1 * 64px - 10px);    /* FIXME: ã†ã¾ãåˆã‚ãªã„ */
        -->
        <div
            class="waratch2-screen-frame"
            style="
                position: absolute;
                width: calc(3 * 64px + 4px);
                height: calc(3 * 64px + 24px + 3px);
                box-sizing: border-box;
            "
        ></div>
    </div>

        
    <!-- ãƒãƒ¼ãƒ‰ã€‚ãŸã ã—ç”»é¢å†…ã¯åˆ‡ã‚ŠæŠœã -->
    <div
        :style="props.hardPositionStyle"
        style="
            position: fixed;
            width: calc(5 * 64px);
            height: calc(7 * 64px);
            background-color: crimson;
            pointer-events: none;  /* ã‚¯ãƒªãƒƒã‚¯ã‚’é€éã•ã›ã¾ã™ */
        "
    >
        <!-- ãƒãƒ¼ãƒ‰å -->
        <div
            class="waratch2-hard-name"
            style="
                left: calc(1 * 64px - 1px); /* ãƒœãƒ¼ãƒ€ãƒ¼å¹…ã‚’å¼•ã„ã¦ã„ã‚‹ */
                top: calc(4.5 * 64px - 32px - 1px);
                width: calc(3 * 64px);
            "
        >Waratch2</div>

        <!-- ãƒœã‚¿ãƒ³é…ç½® -->
        <div
            class="waratch2-buttons-area"
            :style="{
                top: `${5 * 64 - 32}px`,
                width: `${15 * controllerSquareUnit}px`,
                height: `${3 * controllerSquareUnit}px`,
            }"
        >
            <!-- ä¸Šã‚­ãƒ¼ -->
            <v-btn
                class="waratch2-button"
                :style="`
                    top: ${0 * controllerSquareUnit}px;
                    left: ${1.5 * controllerSquareUnit}px;
                    width: ${1 * controllerSquareUnit}px;
                    height: ${1 * controllerSquareUnit}px;
                `"
                @touchstart.prevent="button1Ref?.press($event, emit('onUpButtonPressed'), {repeat: true});"
                @touchend="button1Ref?.release(emit('onUpButtonReleased'));"
                @touchcancel="button1Ref?.release(emit('onUpButtonReleased'));"
                @touchleave="button1Ref?.release(emit('onUpButtonReleased'));"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, emit('onUpButtonPressed'), {repeat: true})"
                @mouseup="button1Ref?.release(emit('onUpButtonReleased'));"
                @mouseleave="button1Ref?.release(emit('onUpButtonReleased'));"
                v-tooltip="'è‡ªæ©Ÿã‚’ä¸Šã¸ã€åƒã‚’é€†å‘ãã¸å‹•ã‹ã™ãœï¼'"
            >â†‘</v-btn>

            <!-- å·¦ã‚­ãƒ¼ -->
            <v-btn
                class="waratch2-button"
                :style="`
                    top: ${1 * controllerSquareUnit}px;
                    left: ${0.5 * controllerSquareUnit}px;
                    width: ${1 * controllerSquareUnit}px;
                    height: ${1 * controllerSquareUnit}px;
                `"
                @touchstart.prevent="button1Ref?.press($event, emit('onLeftButtonPressed'), {repeat: true});"
                @touchend="button1Ref?.release(emit('onLeftButtonReleased'));"
                @touchcancel="button1Ref?.release(emit('onLeftButtonReleased'));"
                @touchleave="button1Ref?.release(emit('onLeftButtonReleased'));"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, emit('onLeftButtonPressed'), {repeat: true})"
                @mouseup="button1Ref?.release(emit('onLeftButtonReleased'));"
                @mouseleave="button1Ref?.release(emit('onLeftButtonReleased'));"
                v-tooltip="'è‡ªæ©Ÿã‚’å·¦ã¸ã€åƒã‚’é€†å‘ãã¸å‹•ã‹ã™ãœï¼'"
            >â†</v-btn>

            <!-- å³ã‚­ãƒ¼ -->
            <v-btn
                class="waratch2-button"
                :style="`
                    top: ${1 * controllerSquareUnit}px;
                    left: ${2.5 * controllerSquareUnit}px;
                    width: ${1 * controllerSquareUnit}px;
                    height: ${1 * controllerSquareUnit}px;
                `"
                @touchstart.prevent="button1Ref?.press($event, emit('onRightButtonPressed'), {repeat: true});"
                @touchend="button1Ref?.release(emit('onRightButtonReleased'));"
                @touchcancel="button1Ref?.release(emit('onRightButtonReleased'));"
                @touchleave="button1Ref?.release(emit('onRightButtonReleased'));"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, emit('onRightButtonPressed'), {repeat: true})"
                @mouseup="button1Ref?.release(emit('onRightButtonReleased'));"
                @mouseleave="button1Ref?.release(emit('onRightButtonReleased'));"
                v-tooltip="'è‡ªæ©Ÿã‚’å³ã¸ã€åƒã‚’é€†å‘ãã¸å‹•ã‹ã™ãœï¼'"
            >â†’</v-btn>

            <!-- ä¸‹ã‚­ãƒ¼ -->
            <v-btn
                class="waratch2-button"
                :style="`
                    top: ${2 * controllerSquareUnit}px;
                    left: ${1.5 * controllerSquareUnit}px;
                    width: ${1 * controllerSquareUnit}px;
                    height: ${1 * controllerSquareUnit}px;
                `"
                @touchstart.prevent="button1Ref?.press($event, emit('onDownButtonPressed'), {repeat: true});"
                @touchend="button1Ref?.release(emit('onDownButtonReleased'));"
                @touchcancel="button1Ref?.release(emit('onDownButtonReleased'));"
                @touchleave="button1Ref?.release(emit('onDownButtonReleased'));"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, emit('onDownButtonPressed'), {repeat: true})"
                @mouseup="button1Ref?.release(emit('onDownButtonReleased'));"
                @mouseleave="button1Ref?.release(emit('onDownButtonReleased'));"
                v-tooltip="'è‡ªæ©Ÿã‚’ä¸‹ã¸ã€åƒã‚’é€†å‘ãã¸å‹•ã‹ã™ãœï¼'"
            >â†“</v-btn>

            <!-- ã‚¹ãƒšãƒ¼ã‚¹ãƒ»ã‚­ãƒ¼ -->
            <v-btn
                class="waratch2-button"
                :style="`
                    top: ${1 * controllerSquareUnit}px;
                    left: ${4.5 * controllerSquareUnit}px;
                    width: ${3 * controllerSquareUnit}px;
                    height: ${1 * controllerSquareUnit}px;
                `"
                @touchstart.prevent="button1Ref?.press($event, emit('onSpaceButtonPressed'), {repeat: true});"
                @touchend="button1Ref?.release(emit('onSpaceButtonReleased'));"
                @touchcancel="button1Ref?.release(emit('onSpaceButtonReleased'));"
                @touchleave="button1Ref?.release(emit('onSpaceButtonReleased'));"
                @mousedown.prevent="button1Ref?.handleMouseDown($event, emit('onSpaceButtonPressed'), {repeat: true})"
                @mouseup="button1Ref?.release(emit('onSpaceButtonReleased'));"
                @mouseleave="button1Ref?.release(emit('onSpaceButtonReleased'));"
                v-tooltip="'è‡ªæ©Ÿã€å°å­—ã®ä½ç½®ã‚’æœ€åˆã«æœ‰ã£ãŸã¨ã“ã‚ã«æˆ»ã™ãœã€‚'"
            >ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ï¼‰</v-btn>

        </div>

        <slot></slot>
    </div>
    ğŸŒŸã‚²ãƒ¼ãƒ ãƒã‚·ãƒ³ãƒ»ãƒ¯ãƒ©ãƒƒãƒï¼’
</template>

<script setup lang="ts">

    // ##############
    // # ã‚¤ãƒ³ãƒãƒ¼ãƒˆ #
    // ##############

    import { ref } from 'vue';

    // ++++++++++++++++++++++++++++++
    // + ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€€ï¼ã€€äº’æ›æ€§å¯¾å¿œ +
    // ++++++++++++++++++++++++++++++

    import type { CompatibleStyleValue }  from '../compatibles/compatible-style-value';

    // ++++++++++++++++++++++++++++++++++
    // + ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€€ï¼ã€€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ +
    // ++++++++++++++++++++++++++++++++++
    //
    // Tauri ãªã‚‰æ˜ç¤ºçš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ Nuxt ãªã‚‰è‡ªå‹•ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã‚Œã‚‹å ´åˆãŒã‚ã‚‹ã€‚
    //

    // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †
    import Button20250822 from '@/components/Button20250822.vue';


    // ####################################
    // # ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå—ã‘å–ã‚‹å¼•æ•° #
    // ####################################
    
    interface Props {
        hardPositionStyle: CompatibleStyleValue;
    }
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
    const props = defineProps<Props>();


    // ################################################
    // # ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå—ã‘å–ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© #
    // ################################################

    interface Emits {
        // ã‚¤ãƒ™ãƒ³ãƒˆåã¨ã€å¤‰æ›´é€šçŸ¥ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã¨ã€ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã®æˆ»ã‚Šå€¤ã€‚
        (event: 'onLeftButtonPressed'): void;
        (event: 'onLeftButtonReleased'): void;
        (event: 'onUpButtonPressed'): void;
        (event: 'onUpButtonReleased'): void;
        (event: 'onRightButtonPressed'): void;
        (event: 'onRightButtonReleased'): void;
        (event: 'onDownButtonPressed'): void;
        (event: 'onDownButtonReleased'): void;
        (event: 'onSpaceButtonPressed'): void;
        (event: 'onSpaceButtonReleased'): void;
        
    }
    const emit = defineEmits<Emits>();


    // ##########
    // # ã‚³ãƒ¢ãƒ³ #
    // ##########
    //
    // ã‚ˆãä½¿ã†è¨­å®šã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã€‚ç‰¹ã«ä¸å¤‰ã®ã‚‚ã®ã€‚
    //    

    const controllerSquareUnit: number = 40;
    // ################
    // # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #
    // ################

    // ++++++++++++++++++++++++++++++++
    // + ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€€ï¼ã€€ãƒœã‚¿ãƒ³æ‹¡å¼µ +
    // ++++++++++++++++++++++++++++++++

    const button1Ref = ref<InstanceType<typeof Button20250822> | null>(null);

</script>

<style scoped>

    @import '@/styles/game-machine-waratch2.css';

</style>
